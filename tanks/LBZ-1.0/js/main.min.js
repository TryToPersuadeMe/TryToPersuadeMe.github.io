const header={button:"header__burgerMenu",navigation:"navigation",screen:"wrapper",logo:"header__logo",language:"language"},handleClick=document.querySelector("."+header.button),nav=document.querySelector("."+header.navigation),body=document.getElementsByTagName("body")[0],screen=document.querySelector("."+header.screen),logo=document.querySelector("."+header.logo),language=document.querySelector("."+header.language),chooseLanguage=document.querySelectorAll("."+header.language);handleClick.addEventListener("click",(function(){this.classList.toggle(header.button+"_active"),nav.classList.toggle(header.navigation+"_active"),screen.classList.toggle("shadow"),body.classList.toggle("block"),handleClick.classList.contains(header.button+"_active")?(logo.style.opacity=0,language.style.opacity=0):(logo.style.opacity=1,language.style.opacity=1)})),window.addEventListener("click",(function(){event.target==nav&&nav.classList.contains(header.navigation+"_active")&&event.target!=handleClick&&(body.classList.remove("block"),handleClick.classList.remove(header.button+"_active"),nav.classList.remove(header.navigation+"_active"),screen.classList.remove("shadow"),logo.style.opacity=1,language.style.opacity=1)}));const menuLink=document.querySelector(".navigation__links_service"),subMenu=document.querySelector(".subMenu");menuLink.addEventListener("mouseenter",(function(){let e=event.currentTarget.nextElementSibling;e.classList.add("subMenu_active"),e.style.maxHeight=10*e.scrollHeight+"px"})),subMenu.addEventListener("mouseleave",(function(){subMenu.classList.remove("subMenu_active"),subMenu.style.maxHeight=subMenu.style.maxHeight=0})),screen.addEventListener("click",(function(){event.target!=subMenu&&(subMenu.style.maxHeight=subMenu.style.maxHeight=0,subMenu.classList.remove("subMenu_active"))})),language.addEventListener("click",(function(){this.querySelector("."+header.language+"__wrapper").classList.toggle(header.language+"_open")}));for(const e of document.querySelectorAll("."+header.language+"__item"))e.addEventListener("click",(function(){this.classList.contains("."+header.language+"__item_selected")||(this.parentNode.querySelector("."+header.language+"__item."+header.language+"__item_selected").classList.remove("."+header.language+"__item_selected"),this.classList.add(header.language+"__item_selected"),this.closest("."+header.language+"__wrapper").querySelector("."+header.language+"__choosen").innerHTML=this.innerHTML)}));window.addEventListener("click",(function(e){const t=document.querySelector("."+header.language+"__wrapper");t.contains(e.target)||t.classList.remove(header.language+"_open")}));const box=document.querySelectorAll(".fieldSetWrapper__box"),column=document.querySelectorAll(".fieldSetWrapper__column");let columnArr=Array.from(column);const responsiveFieldSet=e=>{if(e)for(let e=0;e<column.length;e++)box[0].appendChild(columnArr[e]);else for(let e=0;e<column.length;e++)e<=2?box[0].appendChild(column[e]):box[1].appendChild(column[e])};window.addEventListener("resize",(function(){window.innerWidth<=700?responsiveFieldSet(!0):responsiveFieldSet(!1)})),window.innerWidth<=700&&responsiveFieldSet();let oneTankCompanyCoef=10;window.addEventListener("DOMContentLoaded",()=>{new Calculator({select:".custom-options",wrapper:".fieldSetWrapper",totalSum:"#totalSum",companyName:"#choosenTankCompany",form:".applicationForm__form",columns:".fieldSetWrapper__column",oneCompany:"#oneFullCompany",checkBoxSoloSection:".applicationForm__checkBox",allCompanies:"#allCompanies",selectorWrapper:".custom-select-wrapper",selectorArrow:".arrow"})});class Calculator{constructor(e){this.wrapper=document.querySelector(e.wrapper),this.totalSum=document.querySelector(e.totalSum),this.companyName=document.querySelector(e.companyName),this.form=document.querySelector(e.form),this.columns=document.querySelectorAll(e.columns),this.oneCompany=document.querySelector(e.oneCompany),this.allCompanies=document.querySelector(e.allCompanies),this.checkBoxSoloSection=document.querySelector(e.checkBoxSoloSection),this.selects=document.querySelector(e.select),this.selectorWrapper=document.querySelector(e.selectorWrapper),this.selectorArrow=document.querySelector(e.selectorArrow),this.inputsCheckboxes=this.wrapper.getElementsByTagName("input"),this.choosenSelectValue=0,this.changeValue(!0),this.createArraysForCount(),this.calculate(),this.result,this.pickOneCompany(),this.pickAllCompanies(),this.selects.addEventListener("click",()=>{if(this.choosenSelectValue=event.target.dataset.price_margin,this.changeCompanyName(),this.changeValue(!1),this.createArraysForCount(),this.pickOneCompany(),1==this.oneCompany.checked)this.totalSum.innerText=Number(this.oneCompany.value)+" рублей";else{let e=document.querySelectorAll(":checked");Array.from(e).forEach(e=>{Array.from(this.columns).indexOf(e.offsetParent)==e.dataset.parent_id&&this.columnsAllArr[e.dataset.parent_id].push(Number(e.value))}),this.count()}})}changeValue(e){if(e)for(let e=0;e<this.inputsCheckboxes.length;e++)this.inputsCheckboxes[e].setAttribute("data-default",this.inputsCheckboxes[e].value),this.inputsCheckboxes[e].setAttribute("data-parent_id",Array.from(this.columns).indexOf(this.inputsCheckboxes[e].offsetParent));else{for(let e=0;e<this.inputsCheckboxes.length;e++)this.inputsCheckboxes[e].value=Number(this.choosenSelectValue)+Number(this.inputsCheckboxes[e].dataset.default),this.inputsCheckboxes[e].nextElementSibling.innerText=this.inputsCheckboxes[e].nextElementSibling.innerText.replace(/\(\d{1,}.{1}\)/g,"("+this.inputsCheckboxes[e].value+"р)");this.oneCompany.value=Number(this.oneCompany.dataset.default)+Number(this.choosenSelectValue)*oneTankCompanyCoef,this.oneCompany.nextElementSibling.innerText=Number(this.oneCompany.dataset.default)+Number(this.choosenSelectValue)*oneTankCompanyCoef+" р."}}calculate(){this.count=()=>{this.columnsAllArr.forEach((e,t)=>{this.additionColumnSum[t]=e.reduce((e,t)=>e+t)}),this.result=this.additionColumnSum.reduce((e,t)=>e+t),this.totalSum.innerText=this.result+" рублей"};for(let e=0;e<this.columns.length;e++)this.columns[e].addEventListener("input",()=>{let t=event.target.offsetParent.getElementsByTagName("input");if(event.target.hasAttribute("data-block")&&1==event.target.checked)this.columnsAllArr[e].push(Number(event.target.value)),Array.from(t).forEach(e=>{e!=event.target&&(e.checked=!1,e.setAttribute("disabled","disabled"),e.parentNode.style.opacity=.5)}),this.columnsAllArr[e]=this.columnsAllArr[e].slice(-1),this.count();else if(event.target.hasAttribute("data-block")&&0==event.target.checked)this.columnsAllArr[e].push(Number(event.target.value)),Array.from(t).forEach(e=>{e!=event.target&&(e.removeAttribute("disabled"),e.parentNode.style.opacity=1)}),this.columnsAllArr[e]=[0],this.count();else if(1==event.target.checked)this.columnsAllArr[e].push(Number(event.target.value)),this.count();else{const t=this.columnsAllArr[e].indexOf(Number(event.target.value));t>-1&&this.columnsAllArr[e].splice(t,1),this.count()}})}changeCompanyName(){this.companyName.innerText=event.target.innerText}createArraysForCount(){this.columnsAllArr=[],this.additionColumnSum=[];do{this.additionColumnSum.push([0]),this.columnsAllArr.push([0])}while(this.additionColumnSum.length<this.columns.length)}pickOneCompany(){this.oneCompany.addEventListener("input",()=>{this.createArraysForCount(),1==event.target.checked?(this.checkBoxesToggle(this.inputsCheckboxes,!0),this.totalSum.innerText=Number(event.target.value)+" рублей"):(this.checkBoxesToggle(this.inputsCheckboxes,!1),this.totalSum.innerText="0 рублей")})}pickAllCompanies(){this.allCompanies.addEventListener("input",()=>{this.createArraysForCount(),1==event.target.checked?(this.checkBoxesToggle(this.inputsCheckboxes,!0),this.totalSum.innerText=Number(event.target.value)+" рублей",this.oneCompany.checked=!1,this.oneCompany.setAttribute("disabled","disabled"),this.checkBoxSoloSection.style.opacity=.5,this.selectorArrow.style.opacity=0,this.selectorWrapper.style.overflow="hidden"):(this.checkBoxesToggle(this.inputsCheckboxes,!1),this.totalSum.innerText="0 рублей",this.checkBoxSoloSection.style.opacity=1,this.oneCompany.removeAttribute("disabled","disabled"),this.selectorArrow.style.opacity=1,this.selectorWrapper.style.overflow="visible")})}checkBoxesToggle(e,t){t?Array.from(e).forEach(e=>{e.checked=!1,e.setAttribute("disabled","disabled"),e.parentNode.style.opacity=.5}):Array.from(e).forEach(e=>{e.removeAttribute("disabled"),e.parentNode.style.opacity=1})}}document.querySelector(".custom-select-wrapper").addEventListener("click",(function(){this.querySelector(".custom-select").classList.toggle("open")}));let option=document.querySelectorAll(".custom-option");for(let e=0;e<option.length;e++)option[e].addEventListener("click",(function(){this.classList.contains("selected")||(this.classList.add("selected"),this.parentNode.querySelector(".custom-option.selected").classList.remove("selected"),this.closest(".custom-select").querySelector(".custom-select__trigger span").textContent=this.textContent)}));window.addEventListener("click",(function(e){const t=document.querySelector(".custom-select");t.contains(e.target)||t.classList.remove("open")}));const form=document.getElementById("formLBZ"),name=document.getElementById("name"),allCompanies=document.getElementById("allCompanies"),tankCompany=document.getElementById("oneFullCompany"),tankCompanyName=document.getElementById("choosenTankCompany"),checkBoxColumn=document.querySelectorAll(".fieldSetWrapper__column");let columns,inputs=[],title=[],inputsArr=[];form.addEventListener("submit",(function(){event.preventDefault();let e={select:selectedValue.innerText,name:name.value,email:email.value,contacts:contacts.value,totalSum:totalSum.innerText,lt:[],st:[],tt:[],pt:[],sau:[]};1==tankCompany.checked&&(e["Full-company"]="true"),1==allCompanies.checked&&(e.allCompanies=inputs);for(let e=0;e<checkBoxColumn.length;e++){columns=checkBoxColumn[e],title=columns.getElementsByTagName("legend")[0].innerText;let t=checkBoxColumn[e].getElementsByTagName("input");Array.from(t).forEach(e=>{1==e.checked&&inputsArr.push(e)})}inputsArr.forEach(t=>{switch(t.getAttribute("data-parent_id")){case"0":1!=t.checked||e.lt.includes(t.nextElementSibling.innerText)||e.lt.push(t.nextElementSibling.innerText);break;case"1":1!=t.checked||e.st.includes(t.nextElementSibling.innerText)||e.st.push(t.nextElementSibling.innerText);break;case"2":1!=t.checked||e.tt.includes(t.nextElementSibling.innerText)||e.tt.push(t.nextElementSibling.innerText);break;case"3":1!=t.checked||e.pt.includes(t.nextElementSibling.innerText)||e.pt.push(t.nextElementSibling.innerText);break;case"4":1!=t.checked||e.sau.includes(t.nextElementSibling.innerText)||e.sau.push(t.nextElementSibling.innerText)}}),event.preventDefault();const t=JSON.stringify(e),n=new XMLHttpRequest;n.open("POST","../php/index.php"),n.setRequestHeader("Content-Type","application/json"),n.send(t),console.log(t)}));